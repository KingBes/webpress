<script>
    // 获取当前请求链接
    let path = window.location.pathname;
    if (path === "/") {
        path = "/index";
    }

    // 获取app元素
    const app = htmx.find("#app");

    // 路由
    function route(path) {
        htmx.ajax("GET", `/{$base.routeGroup}${path}`, app)
    }

    // 初始化
    route(path);

    // 监听路由变化
    window.addEventListener('popstate', (event) => {
        if (event.state !== null) {
            route(event.state.path)
        } else {
            route(path)
        }
    });

    // 监听链接点击
    window.addEventListener('click', (event) => {
        const target = event.target;
        const link = target.closest("a");
        if (link && link.href.startsWith(window.location.origin)) {
            let path = link.pathname;
            if (path === "/") {
                path = "/index"
            }
            history.pushState({ path }, '', path);
            route(path);
            event.preventDefault();
        }
    });
</script>
<!-- webpress -->
<script src="/assets/webpress/webpress.js"></script>
</body>

</html>